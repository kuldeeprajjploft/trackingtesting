<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Motive Live Share</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button { padding: 10px; width: 100%; margin-top: 10px; }
    pre {
      background: #111;
      color: #0f0;
      padding: 15px;
      margin-top: 15px;
      white-space: pre-wrap;
      word-break: break-all;
    }
  </style>
</head>
<body>

<h3>Motive Live Share Tracker</h3>

<input
  type="text"
  id="uuid"
  style="width:100%"
  placeholder="Paste Live Share URL"
/>
<button onclick="callApi()">Get Live Share</button>

<pre id="out">Waiting...</pre>

<script>
function isAllowedUrl(url) {
  try {
    const parsed = new URL(url);
    return (
      parsed.origin === "https://cloud.samsara.com" ||
      parsed.origin === "https://tracking.gomotive.com"
    );
  } catch {
    return false;
  }
}

async function callApi() {
  const url = document.getElementById("uuid").value.trim();
  const out = document.getElementById("out");

  if (!url) {
    out.textContent = "URL is required";
    return;
  }

  if (!isAllowedUrl(url)) {
    out.textContent =
      "Invalid URL. Only cloud.samsara.com or tracking.gomotive.com allowed.";
    return;
  }

  out.textContent = "Loading...";
  const updatedKeys = extractLastId(url);
  console.log('Split............');
  console.log(updatedKeys);
  const parsed = new URL(url);
  if(parsed.origin === "https://tracking.gomotive.com") {
    try {
      const res = await fetch(
        `/api/live-share?uuid=${updatedKeys}`
      );
      const data = await res.json();
      out.textContent = JSON.stringify(data, null, 2);
    } catch (e) {
      out.textContent = e.message;
    }
  } else {
    console.log('Inside https://cloud.samsara.com............');
    try {
      const res = await fetch(
        `/api/live-share-clound?uuid=${encodeURIComponent(url)}`
      );
      const data = await res.json();
      out.textContent = JSON.stringify(data, null, 2);
    } catch (e) {
      out.textContent = e.message;
    }
  }
}

function extractLastId(url) {
  try {
    const u = new URL(url);
    // If URL uses hash (GoMotive)
    if (u.hash) {
      const hashParts = u.hash.split("/").filter(Boolean);
      return hashParts[hashParts.length - 1];
    }

    // Normal path-based URL (Samsara)
    const pathParts = u.pathname.split("/").filter(Boolean);
    return pathParts[pathParts.length - 1];

  } catch {
    return null;
  }
}


</script>


</body>
</html>
